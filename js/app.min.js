var game={data:{score:0,volume:"true"==localStorage.getItem("volume")},onload:function(){me.video.init(800,1280,{parent:"screen",scale:"auto",antiAlias:!0,preferWebGL1:!0})?(localStorage.hasOwnProperty("volume")||(localStorage.setItem("volume",!0),game.data.volume=!0),me.state.set(me.state.LOADING,new CustomLoadingScreen),me.state.change(me.state.LOADING),me.audio.init("mp3,ogg"),me.loader.preload(game.resources,this.loaded.bind(this)),me.loader.preload([{name:"klarissa",type:"binary",src:"data/font/klarissa.fnt"},{name:"klarissa",type:"image",src:"data/font/klarissa_0.png"}])):alert("Your browser does not support HTML5 canvas.")},loaded:function(){game.background=new me.video.renderer.Texture(me.loader.getJSON("background"),me.loader.getImage("background")),game.texture=new me.video.renderer.Texture(me.loader.getJSON("texture"),me.loader.getImage("texture")),me.state.set(me.state.PLAY,new game.PlayScreen),me.state.change(me.state.PLAY)},resources:[{name:"bell",type:"audio",src:"data/sfx/"},{name:"squish",type:"audio",src:"data/sfx/"},{name:"yoho",type:"audio",src:"data/sfx/"},{name:"background",type:"image",src:"data/img/background.png"},{name:"texture",type:"image",src:"data/img/texture.png"},{name:"background",type:"json",src:"data/img/background.json"},{name:"texture",type:"json",src:"data/img/texture.json"}]};game.BellSprite=me.Sprite.extend({init:function(e,t,i){me.Sprite.prototype.init.apply(this,[e,t,i]),this.selected=!1,this.isKinematic=!1,this.grabOffset=new me.Vector2d(0,0)},onActivateEvent:function(){me.input.registerPointerEvent("pointerdown",this,this.onSelect.bind(this)),me.input.registerPointerEvent("pointerup",this,this.onRelease.bind(this)),me.input.registerPointerEvent("pointermove",this,this.onRelease.bind(this)),me.input.registerPointerEvent("pointercancel",this,this.onRelease.bind(this))},onSelect:function(e){return this.selected=!0,.8<Math.random()?(me.audio.play("yoho"),game.yoho_sprite.setOpacity(1),game.data.yohos+=1):(me.audio.play("bell"),game.data.bells+=1),game.miori_sprite.setRegion(game.texture.getRegion("mio_1")),game.bell_sprite.setRegion(game.texture.getRegion("bell_1")),game.data.score+=1,game.image_timeout_id&&me.timer.clearTimeout(game.image_timeout_id),game.image_timeout_id=me.timer.setTimeout(function(){game.miori_sprite.setRegion(game.texture.getRegion("mio_0")),game.bell_sprite.setRegion(game.texture.getRegion("bell_0")),game.yoho_sprite.setOpacity(0)},1e3),!this.selected},onRelease:function(){return this.selected=!1},update:function(){return this.selected},draw:function(e){me.Sprite.prototype.draw.apply(this,[e])}}),game.MoguSprite=me.Sprite.extend({init:function(e,t,i){me.Sprite.prototype.init.apply(this,[e,t,i]),this.selected=!1,this.isKinematic=!1,this.grabOffset=new me.Vector2d(0,0)},onActivateEvent:function(){me.input.registerPointerEvent("pointerdown",this,this.onSelect.bind(this)),me.input.registerPointerEvent("pointerup",this,this.onRelease.bind(this)),me.input.registerPointerEvent("pointermove",this,this.onRelease.bind(this)),me.input.registerPointerEvent("pointercancel",this,this.onRelease.bind(this))},onSelect:function(e){return this.selected=!0,me.audio.play("squish"),game.miori_sprite.setRegion(game.texture.getRegion("mio_0")),game.bell_sprite.setRegion(game.texture.getRegion("bell_0")),game.yoho_sprite.setOpacity(0),me.audio.fade("bell",1,0,250),me.audio.fade("yoho",1,0,250),game.image_timeout_id&&me.timer.clearTimeout(game.image_timeout_id),!this.selected},onRelease:function(){return this.selected=!1},update:function(){return this.selected},draw:function(e){me.Sprite.prototype.draw.apply(this,[e])}}),game.HUD=game.HUD||{},game.HUD.Container=me.Container.extend({init:function(){me.Container.prototype.init.apply(this),this.isPersistent=!0,this.floating=!0,this.name="HUD",this.addChild(new game.HUD.ScoreItem(400,1140))}}),game.HUD.ScoreItem=me.Renderable.extend({init:function(e,t){me.Renderable.prototype.init.apply(this,[e,t,0,0]),this.font=new me.BitmapText(800,120,{font:"klarissa"}),this.font.textAlign="center",this.font.textBaseline="bottom",this.font.anchorPoint=new me.Vector2d(.5,.5),this.score=-1},update:function(){return this.score!==game.data.score&&(this.score=game.data.score,!0)},draw:function(e){this.font.draw(me.video.renderer,game.data.score,400,1162)}}),game.UI=game.UI||{},game.UI.VolumeButton=me.GUI_Object.extend({init:function(e,t){var i={};i.image=game.texture,me.GUI_Object.prototype.init.apply(this,[e,t,i]),game.data.volume?(me.audio.unmute("bell"),me.audio.unmute("yoho"),me.audio.unmute("squish"),this.setRegion(game.texture.getRegion("volume_on"))):(me.audio.mute("bell"),me.audio.mute("yoho"),me.audio.mute("squish"),this.setRegion(game.texture.getRegion("volume_off")))},onClick:function(e){return game.data.volume=!game.data.volume,localStorage.setItem("volume",game.data.volume),game.data.volume?(me.audio.unmute("bell"),me.audio.unmute("yoho"),me.audio.unmute("squish"),this.setRegion(game.texture.getRegion("volume_on"))):(me.audio.mute("bell"),me.audio.mute("yoho"),me.audio.mute("squish"),this.setRegion(game.texture.getRegion("volume_off"))),!1}}),game.UI.ShareButton=me.GUI_Object.extend({init:function(e,t){var i={};i.image=game.texture,me.GUI_Object.prototype.init.apply(this,[e,t,i]),this.setRegion(game.texture.getRegion("share"))},onClick:function(e){var t="";0<game.data.score?t+="I got "+game.data.bells+" dings and "+game.data.yohos+" yohos.\n":t+="Miori Bell 2022\n",t+="https://inami0723.github.io/miori-bell/\n\n";t=encodeURIComponent(t);return window.open("https://twitter.com/intent/tweet?text="+t+"&hashtags=mionobouken","_blank"),!1}}),game.UI.TagButton=me.GUI_Object.extend({init:function(e,t){var i={};i.image=game.texture,me.GUI_Object.prototype.init.apply(this,[e,t,i]),this.anchorPoint=new me.Vector2d(1,0),this.setRegion(game.texture.getRegion("tag"))},onClick:function(e){return window.open("https://www.youtube.com/channel/UCyKsg-57XC9pyHbP7v3kCPQ?sub_confirmation=1","_blank"),!1}}),game.UI.CounterHolder=me.GUI_Object.extend({init:function(e,t){var i={};i.image=game.texture,me.GUI_Object.prototype.init.apply(this,[e,t,i]),this.setRegion(game.texture.getRegion("counter"))}});var ProgressBar=me.Renderable.extend({init:function(e,t,i,o){var a=this;this.barHeight=o,me.Renderable.prototype.init.apply(this,[e,t,i,o]),this.anchorPoint.set(0,0),this.loaderHdlr=me.event.subscribe(me.event.LOADER_PROGRESS,a.onProgressUpdate.bind(a)),this.resizeHdlr=me.event.subscribe(me.event.VIEWPORT_ONRESIZE,a.resize.bind(a)),this.progress=0},onProgressUpdate:function(e){this.progress=~~(e*this.width),this.isDirty=!0},draw:function(e){e.clearColor("#202020"),e.setColor("black"),e.fillRect(this.pos.x,me.game.viewport.centerY,e.getWidth(),this.barHeight/2),e.setColor("#E91E63"),e.fillRect(this.pos.x,me.game.viewport.centerY,this.progress,this.barHeight/2)},onDestroyEvent:function(){me.event.unsubscribe(this.loaderHdlr),me.event.unsubscribe(this.resizeHdlr),this.loaderHdlr=this.resizeHdlr=null}}),TextLogo=me.Renderable.extend({init:function(e,t){me.Renderable.prototype.init.apply(this,[0,0,e,t]),this.textWidth=0,this.fontCanvas=me.video.createCanvas(256,64,!0),this.drawFont(me.video.renderer.getContext2d(this.fontCanvas)),this.anchorPoint.set(0,0)},drawFont:function(e){var t=me.pool.pull("me.Text",0,0,{font:"century gothic",size:32,fillStyle:"white",textAlign:"middle",textBaseline:"top",text:"melon"}),i=t.measureText(e).width;this.textWidth=i,this.pos.x=Math.round((this.width-this.textWidth)/2),this.pos.y=Math.round(this.height/2+32),t._drawFont(e,["Loading..."],0,0),me.pool.push(t)},draw:function(e){e.drawImage(this.fontCanvas,Math.round((e.getWidth()-this.textWidth)/2),this.pos.y)}}),CustomLoadingScreen=me.Stage.extend({onResetEvent:function(){me.game.world.addChild(new ProgressBar(0,me.video.renderer.getHeight()/2,me.video.renderer.getWidth(),32),1),me.game.world.addChild(new TextLogo(me.video.renderer.getWidth(),me.video.renderer.getHeight()),2)}});game.PlayScreen=me.Stage.extend({onResetEvent:function(){game.data.score=0,game.data.bells=0,game.data.yohos=0;var e=new me.Sprite(0,0,{image:game.background,region:"background",anchorPoint:new me.Vector2d(0,0)});this.HUD=new game.HUD.Container,me.game.world.addChild(this.HUD,16),this.volumeButton=new game.UI.VolumeButton(100,100),me.game.world.addChild(this.volumeButton,12),this.shareButton=new game.UI.ShareButton(100,264),me.game.world.addChild(this.shareButton,12),this.tagButton=new game.UI.TagButton(780,36),me.game.world.addChild(this.tagButton,12),this.counterHolder=new game.UI.CounterHolder(400,1150),me.game.world.addChild(this.counterHolder,14);var t=new me.Sprite(0,1280,{image:game.texture,region:"table",anchorPoint:new me.Vector2d(0,1)});game.miori_sprite=new me.Sprite(511,575,{image:game.texture,region:"mio_0"}),game.yoho_sprite=new me.Sprite(134,761,{image:game.texture,region:"yoho"}),game.yoho_sprite.alpha=0;var i=new game.MoguSprite(600,1e3,{image:game.texture,region:"mogu"});game.bell_sprite=new game.BellSprite(264,1070,{image:game.texture,region:"bell_0",anchorPoint:new me.Vector2d(.5,1)}),me.game.world.addChild(e,1),me.game.world.addChild(t,12),me.game.world.addChild(i,14),me.game.world.addChild(game.yoho_sprite,14),me.game.world.addChild(game.miori_sprite,10),me.game.world.addChild(game.bell_sprite,14)},onDestroyEvent:function(){me.game.world.removeChild(this.HUD)}});